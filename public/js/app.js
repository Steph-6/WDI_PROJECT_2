"use strict";function calcRoute(e){e&&e.preventDefault();var o=document.getElementById("origin-input").value,t=document.getElementById("destination-input").value,n={origin:o,destination:t,travelMode:"WALKING",provideRouteAlternatives:!0};directionsService.route(n,function(e,o){if("OK"===o){directionsDisplay.setDirections(e);var t=e.routes[0].legs[0];googleMap.createMarkers({lat:t.start_location.lat(),lng:t.start_location.lng()},"./images/person2.png"),googleMap.createMarkers({lat:t.end_location.lat(),lng:t.end_location.lng()},"./images/home.png")}else window.alert("Directions request failed due to "+o)})}function calcRouteHome(e){e&&e.preventDefault();var o=$("#user_location").val(),t=App.currentUser.home,n={origin:o,destination:t,travelMode:"WALKING",provideRouteAlternatives:!0};directionsService.route(n,function(e,o){if("OK"===o){directionsDisplay.setDirections(e);var t=e.routes[0].legs[0];googleMap.createMarkers({lat:t.start_location.lat(),lng:t.start_location.lng()},"./images/person2.png"),googleMap.createMarkers({lat:t.end_location.lat(),lng:t.end_location.lng()},"./images/home.png")}else window.alert("Directions request failed due to "+o)}),$(".modal").modal("hide")}function showInfoModal(){$(".modal-content").html('\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h3 class="modal-title">Info</h4>\n      </div>\n      <div class="modal-body">\n        <h4>Welcome to NightMapper</h4>\n        <p>The app designed to make sure you get home safe.</p>\n        <p>Register your home address and get a route home from your location by clicking "Get Home".\n        Each yellow glow shows a streetlamp, stick to these roads, but try and avoid the red areas. This is where a crime has taken place in the past month.</p>\n      </div>\n      <div class="modal-footer">\n        <p>Made with â™¥ by Steph Robinson.</p>\n      </div>\n    '),$(".modal").modal("show")}function autocomplete(e){var o=new google.maps.LatLngBounds(new google.maps.LatLng(52.957699,(-1.265336))),t={bounds:o};new google.maps.places.Autocomplete(e,t)}function startTime(){var e=new Date,o=e.getHours(),t=e.getMinutes(),n=e.getSeconds();t=checkTime(t),n=checkTime(n),$("#txt").html(o+":"+t+":"+n),setTimeout(startTime,500)}function checkTime(e){return e<10&&(e="0"+e),e}function locate(e){e&&e.preventDefault(),$(".modal-content").html('\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Where are you at the moment?</h4>\n      </div>\n      <div class="modal-body">\n      <form method="post" action="/register" class="usersLocate">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[location]" id="user_location" placeholder="Current Location">\n      </div>\n      <button type="submit" class="btn btn-primary btn-modal">Submit</button>\n      </form>\n    '),$(".modal").modal("show"),autocomplete(document.getElementById("user_location"))}var googleMap=googleMap||{},google=google,directionsDisplay=void 0,directionsService=new google.maps.DirectionsService,App=App||{};googleMap.mapSetup=function(){directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0});var e=15,o=document.getElementById("map-canvas"),t=new google.maps.LatLng(52.956163,(-1.159425)),n=google.maps.MapTypeId.ROADMAP;this.map=new google.maps.Map(o,{zoom:e,center:t,mapTypeId:n,zoomControl:!0,scaleControl:!0,disableDefaultUI:!0,styles:[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:14}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:27},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:14}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}]}),directionsDisplay.setMap(this.map),this.getCrimes(),this.getLights(),autocomplete(document.getElementById("origin-input")),autocomplete(document.getElementById("destination-input")),startTime(),App.init()},App.init=function(){App.url="http://localhost:7000/",$(".directions").on("click",calcRoute),$(".navbar-brand").on("click",showInfoModal),$(".home").on("click",locate),$(".usersNew").on("click",App.register),$(".usersLogin").on("click",App.login),$(".usersLogout").on("click",App.logout),$("body").on("submit",".usersNew",App.handleRegisterForm),$("body").on("submit",".usersLogin",App.handleLoginForm),$("body").on("submit",".usersLocate",calcRouteHome),App.getToken()?App.loggedIn():App.loggedOut()},App.register=function(e){e&&e.preventDefault(),console.log("new"),$(".modal-content").html('\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Register</h4>\n      </div>\n      <div class="modal-body">\n      <form method="post" action="/register" class="usersNew">\n        <div class="form-group">\n          <label for="user_name">First Name</label>\n          <input class="form-control" type="text" name="user[firstName]" id="user_firstName" placeholder="First Name">\n        </div>\n        <div class="form-group">\n          <label for="user_lastName">Last Name</label>\n          <input class="form-control" type="text" name="user[lastName]" id="user_lastName" placeholder="Last Name">\n        </div>\n        <div class="form-group">\n          <label for="user_email">Email</label>\n          <input class="form-control" type="text" name="user[email]" id="user_email" placeholder="Email Address">\n        </div>\n        <div class="form-group">\n          <label for="user_home">Home</label>\n          <input class="form-control" type="text" name="user[home]" id="user_home" placeholder="Home Address">\n        </div>\n        <div class="form-group">\n          <label for="user_password">Password</label>\n          <input class="form-control" type="password" name="user[password]" id="user_password" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <label for="user_passwordConfirmation">Password Confirmation</label>\n          <input class="form-control" type="password" name="user[passwordConfirmation]" id="user_passwordConfirmation" placeholder="Password Confirmation">\n        </div>\n          <button type="submit" class="btn btn-primary btn-modal" value="register">Register</button>\n        </form>\n      </div>\n    '),$(".modal").modal("show"),autocomplete(document.getElementById("user_home"))},App.handleRegisterForm=function(e){console.log("submitted"),e&&e.preventDefault();var o=$(this).serialize();$.ajax({url:"/register",method:"post",data:o,beforeSend:App.setRequestHeader}).done(function(e){e.token&&App.setToken(e.token),App.loggedIn(),$(".modal").modal("hide")})},App.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+App.getToken())},App.setToken=function(e){return window.localStorage.setItem("token",e)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},App.login=function(e){e&&e.preventDefault(),$(".modal-content").html('\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Login</h4>\n      </div>\n      <div class="modal-body">\n      <form method="post" action="/login" class="usersLogin">\n      <div class="form-group">\n        <label for="user_email">Email</label>\n        <input class="form-control" type="text" name="user[email]" id="user_email" placeholder="Email Address">\n      </div>\n      <div class="form-group">\n        <label for="user_password">Password</label>\n        <input class="form-control" type="password" name="user[password]" id="user_password" placeholder="Password">\n      </div>\n      <button type="submit" class="btn btn-primary btn-modal">Login</button>\n      </form>\n    '),$(".modal").modal("show")},App.handleLoginForm=function(e){e&&e.preventDefault();var o=$(this).serialize();$.ajax({url:"/login",method:"post",data:o,beforeSend:App.setRequestHeader}).done(function(e){e.token&&App.setToken(e.token),App.loggedIn(),$(".modal").modal("hide")})},App.logout=function(e){e&&e.preventDefault(),App.removeToken(),App.loggedOut()},App.loggedOut=function(){$("#message").hide(),$(".usersLogin").show(),$(".usersNew").show(),$(".usersLogout").hide(),$(".home").hide()},App.loggedIn=function(){var e=App.getToken(),o=e.split(".")[1],t=JSON.parse(window.atob(o)),n=t.userId;$.get("http://localhost:3000/users/"+n).done(function(e){return App.currentUser=e}),$(".usersLogin").hide(),$(".usersNew").hide(),$(".usersLogout").show(),$(".home").show()},googleMap.getLights=function(){$.get("http://localhost:3000/lights").done(function(e){e.forEach(function(e){googleMap.createMarkers(e)})})},googleMap.createMarkers=function(e,o){new google.maps.Marker({position:{lat:Number(e.lat),lng:Number(e.lng)},map:this.map,shape:{coords:[17,17,18],type:"circle"},icon:{url:o?o:"/images/Glow8.png",scaledSize:o?new google.maps.Size(60,40):new google.maps.Size(5,5),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0),optimized:!1}});setTimeout(function(){$(".loading").hide(),showInfoModal()},2e3)},googleMap.getCrimes=function(){var e=this;$(".loading").show(),$.get("http://localhost:3000/crimes").done(function(o){o.forEach(function(o){var t=new google.maps.Marker({position:{lat:Number(o.lat),lng:Number(o.lng)},map:e.map,icon:{url:"images/red2.png",scaledSize:new google.maps.Size(10,10),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)}});e.addInfoWindowForCrime(o,t)})})},googleMap.addInfoWindowForCrime=function(e,o){var t=this;google.maps.event.addListener(o,"click",function(){"undefined"!=typeof t.infoWindow&&t.infoWindow.close(),t.infoWindow=new google.maps.InfoWindow({content:getCrimeInfo(e)}),t.infoWindow.open(t.map,o),t.map.setCenter(o.getPosition()),t.map.setZoom(16)})},$(googleMap.mapSetup.bind(googleMap));var getCrimeInfo=function(e){var o=e.category.replace(/-/g," ");o=o.charAt(0).toUpperCase()+o.slice(1);var t=e.month.charAt(5)+e.month.charAt(6);return"01"===t?t="January":"02"===t?t="Febuary":"03"===t?t="March":"04"===t?t="April":"05"===t?t="May":"06"===t?t="June":"07"===t?t="July":"08"===t?t="August":"09"===t?t="September":"10"===t?t="October":"11"===t?t="November":"12"===t&&(t="December"),t="in "+t+" "+e.month.charAt(0)+e.month.charAt(1)+e.month.charAt(2)+e.month.charAt(3)+".","<div id='info'>"+o+", "+t+"</div>"};